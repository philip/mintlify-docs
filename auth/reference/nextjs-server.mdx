---
title: Next.js Server SDK Reference
subtitle: Server-side authentication API for Next.js with Neon Auth
description: >-
  Covers the setup of the Neon Auth Next.js server SDK for implementing
  server-side authentication in Next.js applications, detailing installation,
  environment variable configuration, and core functionalities like session
  management and middleware creation.
---

Reference documentation for the Neon Auth Next.js server SDK (`@neondatabase/auth/next/server`). This package provides server-side authentication for Next.js applications using React Server Components, API routes, middleware, and server actions.

For client-side authentication, see the [Client SDK reference](/reference/javascript-sdk). For UI components, see the [UI Components reference](/auth/reference/ui-components).

## Setup

### Installation

Install the Neon Auth package in your Next.js project using npm, yarn, pnpm, or bun.

```bash
npm install @neondatabase/auth@latest
```

### Environment variables

Configure these environment variables in your `.env.local` file:

- **NEON_AUTH_BASE_URL** (required): Your Neon Auth server URL from the Neon Console
- **NEON_AUTH_COOKIE_SECRET** (required): Secret for signing session cookies (must be 32+ characters for HMAC-SHA256 security)

Generate a secure secret with: `openssl rand -base64 32`

```bash
NEON_AUTH_BASE_URL=https://your-neon-auth-url.neon.tech
NEON_AUTH_COOKIE_SECRET=your-secret-at-least-32-characters-long
```

### createNeonAuth()

Creates a unified auth instance that provides all server-side authentication functionality.

Returns an `auth` object with:

- `handler()` — Creates API route handlers
- `middleware()` — Creates Next.js middleware for route protection
- `getSession()` — Retrieves current session
- All Better Auth server methods (signIn, signUp, signOut, etc.)

<ParamField body="baseUrl" type="string" required>
  Your Neon Auth server URL from the Neon Console
</ParamField>

<ParamField body="cookies.secret" type="string" required>
  Secret for HMAC-SHA256 signing (32+ characters)
</ParamField>

<ParamField body="cookies.sessionDataTtl" type="number" default="300">
  Cache TTL in seconds
</ParamField>

<ParamField body="cookies.domain" type="string">
  For cross-subdomain sessions (for example, `.example.com`)
</ParamField>

```typescript
// lib/auth/server.ts
import { createNeonAuth } from '@neondatabase/auth/next/server';

export const auth = createNeonAuth({
  baseUrl: process.env.NEON_AUTH_BASE_URL!,
  cookies: {
    secret: process.env.NEON_AUTH_COOKIE_SECRET!,
  },
});
```

## Route handling

### auth.handler()

Creates GET and POST route handlers for the Neon Auth API proxy.

Create a catch-all route at `app/api/auth/[...path]/route.ts`. This handles all authentication API calls from your client, including sign in/sign up requests, OAuth callbacks, session management, email verification, and password reset.

Returns an object with `GET` and `POST` Next.js route handlers.

```typescript
// app/api/auth/[...path]/route.ts
import { auth } from '@/lib/auth/server';

export const { GET, POST } = auth.handler();
```

### auth.middleware()

Creates Next.js middleware for session validation and route protection.

The middleware automatically validates session cookies on each request, provides session data to server components, redirects unauthenticated users to the login page, and refreshes session tokens when needed.

<ParamField body="loginUrl" type="string" default="/auth/sign-in">
  URL to redirect unauthenticated users to
</ParamField>

```typescript
// middleware.ts
import { auth } from '@/lib/auth/server';

export default auth.middleware({
  loginUrl: '/auth/sign-in'
});

export const config = {
  matcher: [
    "/((?!_next/static|_next/image|favicon.ico).*)",
  ],
};
```

## Session management

### auth.getSession()

Retrieves the current session in Server Components, Server Actions, and API Routes.

- Returns cached session if available (fast)
- Automatically refreshes expired tokens
- Returns null if no active session

Server Components that use `auth.getSession()` must export `dynamic = 'force-dynamic'` because session data depends on cookies.

| Field   | Type            | Description                                          |
| ------- | --------------- | ---------------------------------------------------- |
| `data`  | Session \| null | Session with user data, or null if not authenticated |
| `error` | Error \| null   | Error object if session retrieval failed             |

<CodeGroup>

```typescript Server Component
// app/dashboard/page.tsx
import { auth } from '@/lib/auth/server';

export const dynamic = 'force-dynamic';

export default async function DashboardPage() {
  const { data: session } = await auth.getSession();

  if (!session?.user) {
    return <div>Not authenticated</div>;
  }

  return <h1>Welcome, {session.user.name}</h1>;
}
```

```typescript Server Action
// app/actions.ts
'use server';
import { auth } from '@/lib/auth/server';
import { redirect } from 'next/navigation';

export async function updateProfile(formData: FormData) {
  const { data: session } = await auth.getSession();

  if (!session?.user) {
    redirect('/auth/sign-in');
  }
}
```

```typescript API Route
// app/api/user/route.ts
import { auth } from '@/lib/auth/server';

export async function GET() {
  const { data: session } = await auth.getSession();

  if (!session?.user) {
    return Response.json({ error: 'Unauthorized' }, { status: 401 });
  }

  return Response.json({ user: session.user });
}
```

</CodeGroup>

### auth.listSessions()

List all active sessions for the current user.

```typescript
const { data, error } = await auth.listSessions();
```

### auth.revokeSession()

Revoke a specific session by ID.

<ParamField body="sessionId" type="string" required>
  ID of the session to revoke
</ParamField>

```typescript
const { data, error } = await auth.revokeSession({
  sessionId: 'session-id',
});
```

### auth.revokeOtherSessions()

Revoke all sessions except the current one.

```typescript
const { data, error } = await auth.revokeOtherSessions();
```

## Authentication

### auth.signIn.email()

Sign in with email and password. Use in Server Actions for form-based authentication.

<ParamField body="email" type="string" required>
  User's email address
</ParamField>

<ParamField body="password" type="string" required>
  Account password
</ParamField>

```typescript
'use server';
import { auth } from '@/lib/auth/server';
import { redirect } from 'next/navigation';

export async function signIn(formData: FormData) {
  const { data, error } = await auth.signIn.email({
    email: formData.get('email') as string,
    password: formData.get('password') as string,
  });

  if (error) return { error: error.message };
  redirect('/dashboard');
}
```

### auth.signIn.social()

Sign in with an OAuth provider like Google, GitHub, etc.

<ParamField body="provider" type="string" required>
  OAuth provider name (e.g., `"google"`, `"github"`)
</ParamField>

<ParamField body="callbackURL" type="string">
  URL to redirect to after authorization
</ParamField>

```typescript
const { data, error } = await auth.signIn.social({
  provider: 'google',
  callbackURL: '/dashboard',
});
```

### auth.signIn.emailOtp()

Sign in with email OTP (one-time password). First call `emailOtp.sendVerificationOtp()` to send the code.

<ParamField body="email" type="string" required>
  Email address the OTP was sent to
</ParamField>

<ParamField body="otp" type="string" required>
  The one-time password code
</ParamField>

```typescript
const { data, error } = await auth.signIn.emailOtp({
  email: 'user@example.com',
  otp: '123456',
});
```

### auth.signUp.email()

Create a new user account with email and password.

<ParamField body="email" type="string" required>
  User's email address
</ParamField>

<ParamField body="password" type="string" required>
  Account password
</ParamField>

<ParamField body="name" type="string" required>
  User's display name
</ParamField>

```typescript
const { data, error } = await auth.signUp.email({
  email: 'user@example.com',
  password: 'secure-password',
  name: 'John Doe',
});
```

### auth.signOut()

Sign out the current user. Clears session and authentication tokens.

```typescript
'use server';
import { auth } from '@/lib/auth/server';
import { redirect } from 'next/navigation';

export async function signOut() {
  await auth.signOut();
  redirect('/auth/sign-in');
}
```

## User management

### auth.updateUser()

Update the current user's profile. Password updates require the password reset flow for security.

<ParamField body="name" type="string">
  New display name
</ParamField>

<ParamField body="image" type="string">
  New profile image URL
</ParamField>

```typescript
const { data, error } = await auth.updateUser({
  name: 'Jane Doe',
  image: 'https://example.com/avatar.jpg',
});
```

### auth.changePassword()

Change the current user's password.

<ParamField body="currentPassword" type="string" required>
  Current password for verification
</ParamField>

<ParamField body="newPassword" type="string" required>
  New password
</ParamField>

<ParamField body="revokeOtherSessions" type="boolean">
  Whether to revoke all other sessions after password change
</ParamField>

```typescript
const { data, error } = await auth.changePassword({
  currentPassword: 'old-password',
  newPassword: 'new-password',
  revokeOtherSessions: true,
});
```

### auth.sendVerificationEmail()

Send email verification to the current user.

<ParamField body="callbackURL" type="string">
  URL to redirect to after verification
</ParamField>

```typescript
const { data, error } = await auth.sendVerificationEmail({
  callbackURL: '/dashboard',
});
```

### auth.deleteUser()

Delete the current user account. This action is irreversible.

```typescript
const { data, error } = await auth.deleteUser();
```

### auth.emailOtp.sendVerificationOtp()

Send a one-time password via email. Available when Email OTP authentication is enabled.

<ParamField body="email" type="string" required>
  Email address to send the OTP to
</ParamField>

```typescript
const { data, error } = await auth.emailOtp.sendVerificationOtp({
  email: 'user@example.com',
});
```

### auth.emailOtp.verifyEmail()

Verify email with OTP code.

<ParamField body="email" type="string" required>
  Email address to verify
</ParamField>

<ParamField body="otp" type="string" required>
  The verification code
</ParamField>

```typescript
const { data, error } = await auth.emailOtp.verifyEmail({
  email: 'user@example.com',
  otp: '123456',
});
```

## Organizations

### auth.organization.create()

Create a new organization. Available when the organizations plugin is enabled.

<ParamField body="name" type="string" required>
  Organization name
</ParamField>

<ParamField body="slug" type="string">
  URL-friendly identifier
</ParamField>

```typescript
const { data, error } = await auth.organization.create({
  name: 'My Organization',
  slug: 'my-org',
});
```

### auth.organization.list()

List the current user's organizations.

```typescript
const { data, error } = await auth.organization.list();
```

### auth.organization.inviteMember()

Invite a member to an organization.

<ParamField body="organizationId" type="string" required>
  ID of the organization
</ParamField>

<ParamField body="email" type="string" required>
  Email of the user to invite
</ParamField>

<ParamField body="role" type="string">
  Role to assign (defaults to `"member"`)
</ParamField>

```typescript
const { data, error } = await auth.organization.inviteMember({
  organizationId: 'org-id',
  email: 'member@example.com',
  role: 'member',
});
```

## Admin

### auth.admin.listUsers()

List all users. Available for users with admin role.

<ParamField body="limit" type="number">
  Maximum number of users to return
</ParamField>

<ParamField body="offset" type="number">
  Number of users to skip
</ParamField>

```typescript
const { data, error } = await auth.admin.listUsers({
  limit: 100,
  offset: 0,
});
```

### auth.admin.banUser()

Ban a user. Available for users with admin role.

<ParamField body="userId" type="string" required>
  ID of the user to ban
</ParamField>

<ParamField body="reason" type="string">
  Reason for the ban
</ParamField>

```typescript
const { data, error } = await auth.admin.banUser({
  userId: 'user-id',
  reason: 'Violation of terms',
});
```

### auth.admin.setRole()

Set a user's role. Available for users with admin role.

<ParamField body="userId" type="string" required>
  ID of the user
</ParamField>

<ParamField body="role" type="string" required>
  Role to assign
</ParamField>

```typescript
const { data, error } = await auth.admin.setRole({
  userId: 'user-id',
  role: 'admin',
});
```

## Performance features

### Session caching

Session data is automatically cached in a signed, HTTP-only cookie to reduce API calls to the Auth Server by 95-99%.

- Default cache TTL: 5 minutes (300 seconds)
- Configurable via `cookies.sessionDataTtl`
- Automatic expiration based on JWT `exp` claim
- Synchronous cache clearing on sign-out
- Secure HMAC-SHA256 signing

### Request deduplication

Multiple concurrent `getSession()` calls are automatically deduplicated:

- Single network request for concurrent calls
- 10x faster cold starts
- Reduces server load

```typescript
const { data: session } = await auth.getSession();

// Subsequent calls within TTL: Uses cached data (no API call)
const { data: session2 } = await auth.getSession();
```

## Project structure

Recommended file structure for Next.js with Neon Auth:

```
app/
├── api/
│   └── auth/
│       └── [...path]/
│           └── route.ts
├── auth/
│   └── [path]/
│       └── page.tsx
├── dashboard/
│   └── page.tsx
├── actions.ts
└── layout.tsx

lib/
└── auth/
    ├── server.ts
    └── client.ts

middleware.ts
.env.local
```

## Migration from v0.1

If you're upgrading from Neon Auth SDK v0.1, see the [migration guide](/auth/migrate/from-auth-v0.1) for step-by-step instructions.

## Related documentation

- [Client SDK Reference](/reference/javascript-sdk) - Client-side authentication
- [UI Components Reference](/auth/reference/ui-components) - Pre-built auth UI
- [Next.js Quickstart](/auth/quick-start/nextjs) - Getting started guide
- [Migration Guide](/auth/migrate/from-auth-v0.1) - Upgrading from v0.1

<Snippet file="need-help.mdx" />
